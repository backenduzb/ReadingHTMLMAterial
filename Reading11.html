<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #3e3e3e;
            text-decoration: none;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border: 2px solid #3e3e3e;
            border-radius: 9999px;
            background-color: #ffffff;
            line-height: 1;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon:hover {
            opacity: 1;
        }

        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px);
            /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04;
            /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px;
            /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }

        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px;
            /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
            outline: none;
        }

        .nav-arrow.prev {
            background-color: #4b5563;
        }

        .nav-arrow.next {
            background-color: #000000;
        }

        .nav-arrow:hover {
            transform: translateY(-1px);
        }

        .nav-arrow:active {
            transform: translateY(0);
        }

        .nav-arrow:focus-visible {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;

            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400;
            /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }

        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }



        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }

        .question p {
            margin-bottom: 10px;
        }

        .question ul,
        .question .people-table {
            margin-top: 0;
        }

        .question-prompt {
            margin-bottom: 20px;
        }

        .question ul {
            list-style: none;
            padding-left: 0;
        }

        .question ul li {
            margin-bottom: 5px;
        }

        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
        }

        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }

        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }

        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }

        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .answer-input {
            z-index: 10;
            position: relative;
            pointer-events: auto;
        }

        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }

        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }

        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }

        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }

        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }

        .drag-item:hover {
            background: #e9ecef;
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }

        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }

        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }

        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }

        .drop-zone.disabled {
            pointer-events: none;
        }

        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }

        .drag-options-container {
            margin-top: 10px;
        }

        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }

        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }

        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }

        .questions-container {
            width: 100%;
        }

        audio {
            width: 100%;
            margin-bottom: 20px;
        }

        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }

        .part-header p {
            margin: 0;
        }

        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }

        .question li.incorrect {
            color: #721c24;
        }

        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }

        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }

        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }

        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }

        .audio-modal-icon {
            margin-bottom: 20px;
        }

        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .modal-play-btn:hover {
            background-color: #333;
        }

        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }

        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }

        .tf-question-number,
        .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }

        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }

        .tf-question-text {
            padding-top: 3px;
        }

        .tf-options {
            padding-left: 5px;
        }

        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }

        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }

        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }

        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }

        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }

        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }

        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }

        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }

        .matching-question-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }

        .matching-question-item>span {
            flex: 1;
        }

        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }

        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }

        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }

        .matching-options-bank .drag-item {
            font-size: 15px;
            text-align: center;
            border: 1px solid #ccc;
            background: #f9f9f9;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px;
            /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }

        .summary-completion-container {
            margin-top: 20px;
        }

        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }

        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            min-width: 200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }

        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }

        .summary-drop-zone.active-input {
            border-color: #4a90e2;
            box-shadow: none;
        }

        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }

        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }

        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }

        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p>strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            padding: 2px 6px;
            margin-right: 8px;
            border: 1px solid #d0d7e2;
            border-radius: 6px;
            background: #fff;
        }

        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p>strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }

        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }

        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }

        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }

        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }

        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }

        body.results-mode .multi-choice-option:has(input:checked) {
            box-shadow: none;
        }

        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }

        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }

        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }

        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }

        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }

        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }

        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }

        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }

        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }

        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }

        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }

        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }

        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }

        .results-details-container {
            overflow-y: auto;
            padding-right: 10px;
            /* For scrollbar */
            border-radius: 8px;
        }

        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr 120px;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }

        .result-row.correct {
            background-color: #f3faf5;
        }

        .result-row.incorrect {
            background-color: #fff5f5;
        }

        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .status-badge {
            justify-self: end;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid transparent;
        }

        .status-badge.ok {
            background: #ecfdf5;
            color: #065f46;
            border-color: #a7f3d0;
        }

        .status-badge.bad {
            background: #fff5f5;
            color: #7f1d1d;
            border-color: #f5c6cb;
        }

        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }


        .centered-title {
            text-align: center;
            font-size: 50px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }

        .matching-table .statement {
            text-align: left;
            width: 60%;
        }

        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }

        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }

        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }

        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }

        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }

        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }

        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }

        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }

        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }

        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }

        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }

        .matching-table .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: 40px;
            border: 1px solid #ddd;
            position: relative;
        }

        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }

        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
        }

        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }

        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }

        .matching-table .clickable-cell::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }

        .matching-table .clickable-cell.selected::after {}

        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }

        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }

        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #show-explanation-btn:hover {
            background-color: #357abd;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M8 5v14l11-7L8 5z" />
                    </svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                            d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" />
                    </svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/CDIELTSMaterial" target="_blank" class="telegram-link">
            CD IELTS Materials
        </a>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">Lake Vostok</h4>
                    <p><strong>A</strong>&nbsp;&nbsp;Beneath the white blanket of Antarctica lies half a continent of
                        virtually uncharted territory -
                        an area so completely hidden that scientists have little clue what riches await discovery.
                        Recently, Russian and British glaciologists identified an immense lake - one of Earth’s largest
                        and deepest - buried beneath 4,000 meters of ice immediately below Russia’s Vostok Station
                    </p>
                    <p><strong>B</strong>&nbsp;&nbsp;As details have emerged, a growing number of scientists are showing
                        interest, with dozens of
                        investigators keen to explore the feature, known as Lake Vostok. A thick layer of sediment at
                        the bottom of the lake could hold novel dues to the planet’s climate going back lens of millions
                        of years. By looking at the ratio of different oxygen isotopes, scientists should be able to
                        trace how Earth’s temperature changed over the millennia. NASA has expressed interest in
                        Lake Vostok because of its similarity to Europa. This moon of Jupiter appears to have a water
                        ocean covered by a thick ice sheet, measuring perhaps tens of kilometers in depth. If
                        hydrothermal vents exist beneath the ice, chemical reactions on Europa could have created the
                        molecular building blocks for life, if not life itself. Vostok would be an ideal testing ground
                        for technology that would eventually fly to Europa or places even more distant, say many
                        scientists. Though cheap compared with a Europan mission, any expedition to Vostok would
                        represent a significant investment.</p>
                    <p><strong>C</strong>&nbsp;&nbsp;Vostok Station holds the uncomfortable distinction of having
                        recorded the coldest temperature
                        on Earth. Thermometers there measured in July 1983, and the average temperature hovers
                        around -55ºC. It’s the thick ice, strangely, that enables a lake to survive in such a frozen
                        environment. The 4 kilometers of ice acts effectively as an insulating blanket protecting the
                        bedrock underneath the ice from the cold temperatures above. Geothermal heat coming from
                        the planet’s interior keeps the lake from freezing and warms the lowest layers of ice. The
                        tremendous weight of the ice sheet also plays a role in maintaining the lake. Beneath 4
                        kilometers of glacier, the pressure is intense enough to melt ice at a temperature of -4°C.
                        These
                        factors have helped lakes develop across much of the thickly blanketed East Antarctica. More
                        ore than 70 hidden lakes have been detected in the small portion of the continent to date. Lake
                        Vostok is the largest of these, stretching 280km from south to north and some 60 km from
                        east to west. At Vostok station, which sits at the southern end of the lake, the water depth
                        appears to be 500m according to seismic experiments carried out by Russian researchers.
                    </p>
                    <p><strong>D</strong>&nbsp;&nbsp;The first clues to Lake Vostok’s existence came in the 1970s, when
                        British, U.S., and Danish
                        researchers collected radar observations by flying over this region. The radar penetrates the
                        ice
                        and bounces off whatever sits below. When researchers found a surface as flat as a mirror,
                        they surmised that a lake must exist underneath the ice. An airborne survey of the lake is being
                        undertaken, the first step toward eventually drilling into the water. Along with the potential
                        rewards come a host of challenges. Researchers must find a way to penetrate the icy covering
                        without introducing any microorganisms or pollutants into the sealed-off water.
                    </p>
                    <p><strong>E</strong>&nbsp;&nbsp;What about life in the depths? If tiny microbes do populate the
                        lake, they may be some of the
                        hungriest organisms ever discovered. Lake Vostok has the potential to be one of the most
                        energy-limited, or oligotrophic, environments on the planet. For the lake’s residents, the only
                        nutrients would come from below. Russian investigators have speculated that the lake floor
                        may have hot springs spewing out hydrothermal fluids stocked with reduced metals and other
                        sorts of chemical nutrients. Scant geological evidence available for this region, however,
                        indicates that the crust is old and dead. Without a stream of nutrients seeping up from the
                        deep Earth, the only potential source of energy lies above the lake. The ice sheet above the
                        water is creeping from west to east at a rate of roughly four meters per year. The lowermost
                        layers of ice melt when they come in contact with the lake, liberating trapped gases and bits of
                        crushed-up rock. If the glacier recently passed over rock before reaching the lake, it could be
                        supplying organic compounds useful to microorganisms. It also could be seeding the lake with a
                        continuous source of new residents. Bacteria, yeasts, fungi, algae and even pollen grains have
                        been found in the Vostok ice core samples taken down to depths of 2,750m - three quarters of
                        the way to the bottom. At least some of these organisms are alive and capable of growing,
                        according to recent reports. The results of this analysis may indirectly indicate whether
                        anything survives in the lightless body of water.</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">The cells from hell</h4>
                    <p><strong>A</strong>&nbsp;&nbsp;Recently, an international team of biologists met to discuss what
                        they believe is a global crisis
                        in the sudden appearance of strange marine microorganisms capable of poisoning not just fish
                        but people too. <br><br>
                        In the mid-1980s, fishermen in North Carolina, on the eastern coast of the United States, began
                        complaining about mysterious fish kills. They were convinced that pollution was responsible
                        but nobody would listen. That changed in 1988 after an accident at. a research center. Tank
                        after tank of fish suddenly died. Researchers spotted an unknown microorganism in the water.
                        It was later named pfiesteria.
                        <br><br>
                        Pfiesteria belongs to a prehistoric group of algae that are part plant, part animal. They are
                        called dinoflagellates after the liny whips or flagella that propel them through the wafer.
                        Magnified a thousand limes they are some of the strangest and most beautiful creatures in the
                        sea. They are at the bottom of the food chain but, to deter fish from swallowing them, some
                        have evolved powerful toxins.
                        <br><br>
                        As the researchers were to discover, pfiesteria doesn’t just discourage fish. It actively hunts
                        them, then eats them. Fish are one of its preferred foods but one of the intriguing things about
                        pfiesteria is that it will eat everything from bacteria to dead plant and animal remains all the
                        way up to mammalian tissues. So its food spans the entire food web of an estuary. Gradually
                        the researchers realised that nothing in the water was safe from pfiesteria. It could harm
                        humans too. A mis-directed air-conditioning duct from a room containing the toxins nearly
                        killed one of the researchers. He suffered a host of symptoms ranging from profuse sweating,
                        tingling hands and feet, to liver and kidney problems, as well as memory <br><br>
                        As the research intensified, some startling discoveries were made. In tanks, pfiesteria was
                        quite
                        content to behave like a plant and photosynthesize. However, when fish were added, a
                        dramatic transformation occurred, pfiesteria switched to attack mode. In a matter of minutes it
                        changed shape and secreted a toxin. The fish quickly became disorientated and within five
                        minutes all were dead. Pfiesteria changed shape again and devoured them. When it had had its
                        fill, it vanished. No one had ever seen an organism do this. <br><br>
                        Initially scientists believed this was part of a natural cycle, but on closer examination, it
                        seemed
                        pollution was to blame. When the water containing the biggest fish kills was analysed,
                        scientists found high levels of pollution. But this is just one of the factors that can boost
                        the
                        transformation in pfiesteria. Others include large numbers of fish travelling together which
                        feed
                        in poorly flushed places with a lot of algae to eat and other rich food sources. That is the
                        perfect habitat for pfiesteria.
                        <br><br>But pfiesteria is not the only concern. In the oceans all around the world similar kinds
                        of algae
                        are now materialising and turning toxic. In the last decade these algal blooms¹ have poisoned
                        sea-lions in California, caused catastrophic fish kills in the Pacific, the Mediterranean and
                        the
                        North Sea, and devastated the shellfish industry in New Zealand. Researchers from forty-seven
                        nations met recently to share the latest information about harmful algal blooms. They heard
                        about new kinds of toxins and discussed possible links between algae and whale standings.
                        But what dominated the proceedings was news that toxic algae are spreading to new shores in
                        ballast water carried by ships. <br><br>

                        That may have already happened in Australian waters. A tuna kill in 1996 cost fish farmers an
                        estimated $45 million. The official explanation was that a storm was to blame. But there were
                        also reports of orange-brown streaks in the water. When a water sample was examined, it was
                        found to be teeming with an alga never before seen in Australia, called chattonella. The same
                        chattonella killed half a billion dollars’ worth of fish in Japan in 1972.
                        <br><br>

                        This toxin was also present in the livers of the dead tuna. Despite this powerful evidence, the
                        official explanation remains that a storm was the killer. However, in Japan this was a prime
                        example of an algal bloom induced by the waste products of the aquaculture industry itself,
                        and of course that is not something that the tuna industry wants to hear.
                        <br><br>
                        It is clear that chattonella is present in Australian waters. But there is little knowledge of
                        what
                        else may surface or where it may have come from. What is of greater concern is that, in
                        Australia and around the world, there is a reluctance to acknowledge that it is human activity
                        which is triggering the transformation of normally benign organisms into increasingly
                        dangerous forms. If we continue to mismanage the way nutrients and pollutants are released
                        into the environment, we will have to confront new versions of the cells from hell.
                        <br><br>
                        Glossary
                        <br><br>
                        ¹ algal bloom: The rapid growth under specific conditions, of minute aquatic plants
                    </p>



                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">Mystery of the mummies</h4>
                    <p><strong>A</strong>&nbsp;&nbsp;In 1992, a German scientist made a discovery which was to upset
                        whole areas of scientific
                        study from history and archaeology to chemistry and botany. Dr. Svetlana Balabanova, a
                        forensic specialist, was performing tissue tests on an Egyptian mummy, part of a German
                        museum collection. The mummified remains were of a woman named Henut-Taui who had
                        died over 3,000 years ago. Amazingly, the tests revealed that her body contained large
                        quantities of cocaine and nicotine. Dr. Balabanova had regularly used the same testing methods
                        to convict people of drug consumption but she had not expected to find nicotine and cocaine in
                        an Ancient Egyptian mummy. It is generally accepted that these two plants, native to the
                        Americas, did not exist on other continents prior to European exploration.
                        <br><br>
                        Dr. Balabanova repeated the tests then sent out fresh samples to three other labs. When the
                        results came back positive, she published a paper with two other scientists. If Balabanova was
                        shocked by the results of her tests, she was even more shocked at the hostile response to her
                        publication. She received many insulting letters, accusing her of fraud.
                        <br><br>
                        There were two explanations that came immediately to mind. One was that something in the
                        tests could have given a false result. The second was that the mummies tested were not truly
                        Ancient Egyptian. Perhaps they were relatively modern bodies, containing traces of cocaine. Dr.
                        Balabanova then examined tissue from 134 naturally preserved bodies over a thousand years
                        old discovered in an excavated cemetery in the Sudan. About a third of them tested positive for
                        nicotine or cocaine.
                        <br><br>
                        But something had happened even earlier which should have initiated serious discussion. In
                        1976, the mummified remains of Ramses II arrived in Paris for repair work. Dr. Michelle Lescot
                        of the Natural History Museum (Paris) was looking at sections of bandages and within the
                        fibres found a plant fragment. When she checked it under a microscope, she was amazed to
                        discover that the plant was tobacco. Fearing that she had made some mistake, she repeated
                        her tests again and again with the same result every time: a New World plant had been found
                        on an Old World mummy. The results caused a sensation in Europe. Was it possible that a
                        piece of tobacco had been dropped by chance from the pipe of some forgotten archaeologist?
                        Dr. Lescot responded to this charge of contamination by carefully extracting new samples from
                        the abdomen, with the entire process recorded on film. These samples, which could not be
                        ‘droppings’, were then tested. Once again they were shown to be tobacco. The discovery of
                        tobacco fragments in the mummified body of Ramses II should have had a profound influence
                        upon our whole understanding of the relationship between Ancient Egypt and America but this
                        piece of evidence was simply ignored. It raised too many questions and was too far outside of
                        commonly accepted scientific views.
                        <br><br>
                        So now the question had returned. Could Ancient Egyptian trade have stretched all the way
                        across the Atlantic Ocean? This was an idea so unbelievable it could only be considered after
                        all
                        other possibilities had been eliminated. Could Egyptians have obtained imports from a place
                        thousands of miles away, from a continent supposedly not discovered until thousands of years
                        later? Was it possible that coca - a plant from South America - had found its way to Egypt
                        3,000 years ago? If the cocaine found in mummies could not be explained by contamination, or
                        fake mummies or by Egyptian plants containing it, there appeared to be another interesting
                        possibility: a trade route with links all the way to the Americas.

                        br
                        <br><br>
                        The Egyptians did make great efforts to obtain incense and other valuable plants used in
                        religious ceremonies and herbal medicines, but to the majority of archaeologists, the idea is
                        hardly worth talking about. Professor John Baines, an Egyptologist from Oxford University,
                        states: ‘I don’t think it is at all likely that there was an ancient trade network that included
                        America. The essential problem with any such idea is that there are no artefacts found either in
                        Europe or in America.’ But other experts aren’t so sure. Professor Martin Bernal, an historian
                        from Cornell University, says, ‘We’re getting more and more evidence of world trade at an
                        earlier stage. You have the Chinese silk definitely arriving in Egypt by 1000 BC.’ In his
                        opinion, it
                        is arrogance on the part of modern people to believe that a transoceanic trading network could
                        only have been set up in recent times. <br><br>
                        The discoveries in mummies from Egypt and Sudan have challenged conventional beliefs. It is
                        no longer possible to exclude the hypothesis of transoceanic trade in ancient times. The tale of
                        Henut-Taui and the story of Ramses II show that, in science, facts can be rejected if they don’t
                        fit with our beliefs, while what is believed to be proven, may actually be uncertain. It is
                        understandable then, how a story of a scientist, a few mummies and some routine tests, could
                        upset whole areas of knowledge we thought we could take for granted.


                    </p>
                </div>

            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="3">
                            <div class="question-prompt">
                                <p><strong>Questions 1-3</strong></p>
                                <p>Answer the following questions using <strong>NO MORE THAN THREE WORDS</strong> from
                                    the passage about Juliane Koepcke’s plane crash survival story.</p>
                            </div>
                            <div class="summary-text">
                                <p>How old was Juliane at the time of the crash? <input type="text" class="answer-input"
                                        id="q1" placeholder="1"></p>
                                <p>What is her occupation now? <input type="text" class="answer-input" id="q2"
                                        placeholder="2"></p>
                                <p>What was the cause of the plane crash? <input type="text" class="answer-input"
                                        id="q3" placeholder="3"></p>
                            </div>
                        </div>

                        <div class="question" data-q-start="4" data-q-end="10">
                            <div class="question-prompt">
                                <p><strong>Questions 4-10</strong></p>
                                <p>Choose the correct letter A-D from the information given in the passage about Juliane
                                    Koepcke’s plane crash survival story.</p>
                            </div>
                            <div class="multi-choice-question" data-q-start="4" data-q-end="4">
                                <div class="question-prompt">
                                    <p><strong>4</strong> What happened to the plane?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q4" value="A"> A - It
                                        broke apart in the air</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q4" value="B"> B - It
                                        hit trees and exploded</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q4" value="C"> C - It
                                        crashed into a mountainside</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q4" value="D"> D - It
                                        hit the ground and burst into flames</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="5" data-q-end="5">
                                <div class="question-prompt">
                                    <p><strong>5</strong> Which of the following did NOT help to slow her fall?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q5" value="A"> A - an
                                        updraft caused by storm clouds</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q5" value="B"> B -
                                        hitting vines</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q5" value="C"> C - the
                                        section of seats to which she was attached</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q5" value="D"> D - a
                                        parachute</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="6" data-q-end="6">
                                <div class="question-prompt">
                                    <p><strong>6</strong> Which of the following injuries did she sustain?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q6" value="A"> A - a
                                        broken foot</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q6" value="B"> B - a
                                        broken arm</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q6" value="C"> C -
                                        concussion</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q6" value="D"> D -
                                        cuts on her head</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="7" data-q-end="7">
                                <div class="question-prompt">
                                    <p><strong>7</strong> What helped her to survive?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q7" value="A"> A -
                                        Knowledge of the jungle</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q7" value="B"> B - a
                                        map showing the location of the river</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q7" value="C"> C -
                                        appropriate clothing and shoes</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q7" value="D"> D -
                                        food supplies from the plane</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="8" data-q-end="8">
                                <div class="question-prompt">
                                    <p><strong>8</strong> What was the biggest threat to her survival?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q8" value="A"> A -
                                        infected wounds</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q8" value="B"> B -
                                        sting rays</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q8" value="C"> C -
                                        starvation</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q8" value="D"> D -
                                        crocodiles</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="9" data-q-end="9">
                                <div class="question-prompt">
                                    <p><strong>9</strong> How long was she lost in the jungle?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q9" value="A"> A - 3
                                        days</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q9" value="B"> B - 5
                                        days</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q9" value="C"> C - 10
                                        days</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q9" value="D"> D - 15
                                        days</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="10" data-q-end="10">
                                <div class="question-prompt">
                                    <p><strong>10</strong> How was she finally rescued?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q10" value="A"> A - A
                                        search party found her in the jungle</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q10" value="B"> B -
                                        Native hunters found her</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q10" value="C"> C -
                                        She signaled to a plane from the river</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q10" value="D"> D -
                                        She reached a campsite along the river</label></div>
                            </div>
                        </div>

                        <div class="question" data-q-start="11" data-q-end="14">
                            <div class="question-prompt">
                                <p><strong>Questions 11-14</strong></p>
                                <p>Do the following statements agree with the views of the writer in the passage about
                                    Juliane Koepcke’s plane crash survival story?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>YES</strong> if the statement agrees with the views of the writer</li>
                                    <li><strong>NO</strong> if the statement contradicts the views of the writer</li>
                                    <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks
                                        about this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="11" data-q-end="11">
                                <div class="tf-question-line"><span class="tf-question-number">11</span><span
                                        class="tf-question-text">Other survivors of the crash were found in the
                                        jungle.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q11" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="12" data-q-end="12">
                                <div class="tf-question-line"><span class="tf-question-number">12</span><span
                                        class="tf-question-text">Juliane was upset when she re-visited the crash
                                        site.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q12" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="13" data-q-end="13">
                                <div class="tf-question-line"><span class="tf-question-number">13</span><span
                                        class="tf-question-text">Wings of Hope is the name given to a memorial
                                        statue.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q13" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="14" data-q-end="14">
                                <div class="tf-question-line"><span class="tf-question-number">14</span><span
                                        class="tf-question-text">Juliane suffered nightmares for many years as a result
                                        of her experience.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q14" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q14" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q14" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-2" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="15" data-q-end="19">
                            <div class="question-prompt">
                                <p><strong>Questions 15-19</strong></p>
                                <p>Classify the following as relating to:</p>
                                <p>A - the silk of Bombyx mori<br>
                                    B - dragline silk of Nephila clavipes<br>
                                    C - capture silk of Nephila clavipes</p>
                                <p><strong>Example Answer</strong><br>forms the cocoon: A</p>
                            </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>15.</strong> forms the framework of a
                                        web</span>
                                    <select class="answer-input" id="q15">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>16.</strong> most elastic silk</span>
                                    <select class="answer-input" id="q16">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>17.</strong> allows predator to drop
                                        quickly</span>
                                    <select class="answer-input" id="q17">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>18.</strong> single strand can be up to
                                        900 metres long</span>
                                    <select class="answer-input" id="q18">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>19.</strong> strongest silk</span>
                                    <select class="answer-input" id="q19">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="20" data-q-end="24">
                            <div class="question-prompt">
                                <p><strong>Questions 20-24</strong></p>
                                <p>Do the following statements agree with the claims of the writer in the passage about
                                    spider silk?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>YES</strong> if the statement agrees with the views of the writer</li>
                                    <li><strong>NO</strong> if the statement contradicts the views of the writer</li>
                                    <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks
                                        about this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="20" data-q-end="20">
                                <div class="tf-question-line"><span class="tf-question-number">20</span><span
                                        class="tf-question-text">All spiders secrete silk.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q20" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q20" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q20" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="21" data-q-end="21">
                                <div class="tf-question-line"><span class="tf-question-number">21</span><span
                                        class="tf-question-text">Artificial genes for spider silk have been
                                        produced.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q21" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q21" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q21" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="22" data-q-end="22">
                                <div class="tf-question-line"><span class="tf-question-number">22</span><span
                                        class="tf-question-text">Spider silk protein occurs naturally in goats’
                                        milk.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q22" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q22" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q22" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="23" data-q-end="23">
                                <div class="tf-question-line"><span class="tf-question-number">23</span><span
                                        class="tf-question-text">China is leading research efforts in the area of spider
                                        silk.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q23" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q23" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q23" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="24" data-q-end="24">
                                <div class="tf-question-line"><span class="tf-question-number">24</span><span
                                        class="tf-question-text">Spider silk is now being produced commercially.</span>
                                </div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q24" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q24" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q24" value="NOT GIVEN"> NOT
                                        GIVEN</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="25" data-q-end="27">
                            <div class="question-prompt">
                                <p><strong>Questions 25-27</strong></p>
                                <p>Using <strong>NO MORE THAN THREE WORDS</strong> from the passage about spider silk
                                    for each answer, complete the following.</p>
                            </div>
                            <div class="summary-text">
                                <p>Main problem in the production of synthetic fibres: <input type="text"
                                        class="answer-input" id="q25" placeholder="25"></p>
                                <p>3 disadvantages of natural fibres: <input type="text" class="answer-input" id="q26"
                                        placeholder="26"></p>
                                <p>Proportion of clothing made from natural fibre: <input type="text"
                                        class="answer-input" id="q27" placeholder="27"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-3" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="28" data-q-end="31">
                            <div class="question-prompt">
                                <p><strong>Questions 28-31</strong></p>
                                <p>Complete the summary. Choose your answers from the box below the summary. There are
                                    more words than you will need to fill the gaps.</p>
                                <p><strong>List of Words</strong><br>
                                    axis, estimate, perspective, map, direction, compare, size, judge, accurately,
                                    angle, distances, models, projection, change
                                </p>
                                <p><strong>Example</strong><br>For four centuries, map makers have been trying to
                                    convert three-dimensional information as accurately as possible onto a
                                    two-dimensional plane.</p>
                            </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <span class="matching-form-label">However, each method of <strong>28.</strong>
                                        involves a compromise.</span>
                                    <select class="answer-input" id="q28">
                                        <option value="">Select</option>
                                        <option value="axis">axis</option>
                                        <option value="estimate">estimate</option>
                                        <option value="perspective">perspective</option>
                                        <option value="map">map</option>
                                        <option value="direction">direction</option>
                                        <option value="compare">compare</option>
                                        <option value="size">size</option>
                                        <option value="judge">judge</option>
                                        <option value="accurately">accurately</option>
                                        <option value="angle">angle</option>
                                        <option value="distances">distances</option>
                                        <option value="models">models</option>
                                        <option value="projection">projection</option>
                                        <option value="change">change</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label">Thus Mercator’s projection indicates true north
                                        and south, known as fidelity of <strong>29.</strong></span>
                                    <select class="answer-input" id="q29">
                                        <option value="">Select</option>
                                        <option value="axis">axis</option>
                                        <option value="estimate">estimate</option>
                                        <option value="perspective">perspective</option>
                                        <option value="map">map</option>
                                        <option value="direction">direction</option>
                                        <option value="compare">compare</option>
                                        <option value="size">size</option>
                                        <option value="judge">judge</option>
                                        <option value="accurately">accurately</option>
                                        <option value="angle">angle</option>
                                        <option value="distances">distances</option>
                                        <option value="models">models</option>
                                        <option value="projection">projection</option>
                                        <option value="change">change</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label">Dr. Peters felt that such maps presented a
                                        first-world <strong>30.</strong></span>
                                    <select class="answer-input" id="q30">
                                        <option value="">Select</option>
                                        <option value="axis">axis</option>
                                        <option value="estimate">estimate</option>
                                        <option value="perspective">perspective</option>
                                        <option value="map">map</option>
                                        <option value="direction">direction</option>
                                        <option value="compare">compare</option>
                                        <option value="size">size</option>
                                        <option value="judge">judge</option>
                                        <option value="accurately">accurately</option>
                                        <option value="angle">angle</option>
                                        <option value="distances">distances</option>
                                        <option value="models">models</option>
                                        <option value="projection">projection</option>
                                        <option value="change">change</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label">His map, with equal area projection, enables us to
                                        <strong>31.</strong> the size of one country with another.</span>
                                    <select class="answer-input" id="q31">
                                        <option value="">Select</option>
                                        <option value="axis">axis</option>
                                        <option value="estimate">estimate</option>
                                        <option value="perspective">perspective</option>
                                        <option value="map">map</option>
                                        <option value="direction">direction</option>
                                        <option value="compare">compare</option>
                                        <option value="size">size</option>
                                        <option value="judge">judge</option>
                                        <option value="accurately">accurately</option>
                                        <option value="angle">angle</option>
                                        <option value="distances">distances</option>
                                        <option value="models">models</option>
                                        <option value="projection">projection</option>
                                        <option value="change">change</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="32" data-q-end="36">
                            <div class="question-prompt">
                                <p><strong>Questions 32-36</strong></p>
                                <p>Use the information in the text to match the map projections [M A P] with the
                                    characteristics listed below.</p>
                                <p>M - Mercator projection<br>A - Aitoff projection<br>P - Peters projection</p>
                                <p><strong>Example</strong><br>designed for the needs of early navigators: M</p>
                            </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>32.</strong> makes Europe seem larger than
                                        it is</span>
                                    <select class="answer-input" id="q32">
                                        <option value="">Select</option>
                                        <option value="M">M - Mercator projection</option>
                                        <option value="A">A - Aitoff projection</option>
                                        <option value="P">P - Peters projection</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>33.</strong> maximum distortions at the
                                        poles</span>
                                    <select class="answer-input" id="q33">
                                        <option value="">Select</option>
                                        <option value="M">M - Mercator projection</option>
                                        <option value="A">A - Aitoff projection</option>
                                        <option value="P">P - Peters projection</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>34.</strong> maintains greatest accuracy
                                        at 45 degrees latitude</span>
                                    <select class="answer-input" id="q34">
                                        <option value="">Select</option>
                                        <option value="M">M - Mercator projection</option>
                                        <option value="A">A - Aitoff projection</option>
                                        <option value="P">P - Peters projection</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>35.</strong> most distorts the position of
                                        the equator</span>
                                    <select class="answer-input" id="q35">
                                        <option value="">Select</option>
                                        <option value="M">M - Mercator projection</option>
                                        <option value="A">A - Aitoff projection</option>
                                        <option value="P">P - Peters projection</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>36.</strong> more accurately represents
                                        country shapes and sizes</span>
                                    <select class="answer-input" id="q36">
                                        <option value="">Select</option>
                                        <option value="M">M - Mercator projection</option>
                                        <option value="A">A - Aitoff projection</option>
                                        <option value="P">P - Peters projection</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="37" data-q-end="39">
                            <div class="question-prompt">
                                <p><strong>Questions 37-39</strong></p>
                                <p>Choose one drawing (A-D) to match each of the three projection types (37-39). There
                                    are more drawings than names so you will not use all of them.</p>
                                <img src="https://i.postimg.cc/28dSp96f/Screenshot-2025-08-26-084333.png" alt="">
                                <img src="https://i.postimg.cc/5ty4Cxmx/Screenshot-2025-08-26-084656.png" alt="">
                            </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>37.</strong> Mercator projection</span>
                                    <select class="answer-input" id="q37">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>38.</strong> Aitoff projection</span>
                                    <select class="answer-input" id="q38">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>39.</strong> Peters projection</span>
                                    <select class="answer-input" id="q39">
                                        <option value="">Select</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="40" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Question 40</strong></p>
                                <p>Choose the correct letter A-D from the information given in the passage about map
                                    projections.</p>
                            </div>
                            <div class="multi-choice-question" data-q-start="40" data-q-end="40">
                                <div class="question-prompt">
                                    <p><strong>40</strong> The main point made by the writer of this article is that we
                                        need to ...</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q40" value="A"> A -
                                        understand maps.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q40" value="B"> B -
                                        understand map-making.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q40" value="C"> C -
                                        understand that maps are not objective.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q40" value="D"> D -
                                        understand the importance of latitude and longitude.</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question
                        1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question
                        2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question
                        3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question
                        4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question
                        5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question
                        6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question
                        7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question
                        8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question
                        9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question
                        10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question
                        11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question
                        12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question
                        13</span><span aria-hidden="true">13</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question
                        14</span><span aria-hidden="true">14</span></button>
            </div>
        </div>

        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">

                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question
                        15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question
                        16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question
                        17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question
                        18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question
                        19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question
                        20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question
                        21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question
                        22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question
                        23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question
                        24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question
                        25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question
                        26</span><span aria-hidden="true">26</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question
                        27</span><span aria-hidden="true">27</span></button>
            </div>
        </div>

        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">

                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question
                        28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question
                        29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question
                        30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question
                        31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question
                        32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question
                        33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question
                        34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question
                        35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question
                        36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question
                        37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question
                        38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question
                        39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question
                        40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>

        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE VARIABLES ---
            let currentPassage = 1;
            let currentQuestion = 1;
            let selectedRange = null;
            let timeInSeconds = 3600;
            let timerInterval;
            let draggedItem = null;
            let activeQuestionElement = null;
            let selectedDragItem = null;

            // --- GLOBAL FUNCTIONS ---
            function getFirstQuestionOfPart(part) {
                switch (part) {
                    case 1: return 1;
                    case 2: return 14;
                    case 3: return 27;
                    default: return 1;
                }
            }

            // --- DOM ELEMENTS ---
            const timerDisplay = document.querySelector('.timer-display');
            const timerToggleButton = document.getElementById('timer-toggle-btn');
            const timerResetButton = document.getElementById('timer-reset-btn');
            const deliverButton = document.getElementById('deliver-button');
            const resizer = document.getElementById('resizer');
            const passagePanel = document.getElementById('passage-panel');
            const questionsPanel = document.getElementById('questions-panel');
            const contextMenu = document.getElementById('contextMenu');

            // --- ICON SVGs ---
            const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
            const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

            const correctAnswers = {
                '1': "viii",
                '2': "ii",
                '3': "iv",
                '4': "iii",
                '5': "B",
                '6': "A",
                '14': "plant",
                '15': "poisons",
                '16': "eats",
                '17': "disappears",
                '18': "pollution",
                '19': "large numbers of",
                '20': "new kinds of",
                '21': "carried by ship",
                '22': "C",
                '23': "B",
                '24': "C",
                '25': "B",
                '26': "A",
                '27': "D",
                '28': "A",
                '29': "B",
                '30': "B",
                '31': "C",
                '32': "A/B",
                '33': "D",
                '34': "A",
                '35': "NO",
                '36': "YES",
                '37': "NOT GIVEN",
                '38': "YES",
                '39': "NOT GIVEN",
                '40': "B"
            }





            // --- INITIALIZATION ---
            function initialize() {
                console.log(`🚀 Initializing application...`);
                startTimer();
                initializeDragAndDrop();
                setupCheckboxLimits();
                setupExampleHeading();
                console.log(`📋 Setting up initial state - switching to part 1`);
                switchToPart(1); // Also calls goToQuestion(1) and updateNavigation

                document.body.addEventListener('input', updateAllIndicators);
                document.body.addEventListener('change', updateAllIndicators);
                deliverButton.addEventListener('click', checkAnswers);
                timerToggleButton.addEventListener('click', toggleTimer);
                timerResetButton.addEventListener('click', resetTimer);

                // Auto-close dropdowns for Questions 14-17 on selection
                ['q14', 'q15', 'q16', 'q17'].forEach(id => {
                    const sel = document.getElementById(id);
                    if (sel) {
                        sel.addEventListener('change', () => sel.blur());
                    }
                });

                // Add click listeners to question containers for navigation
                document.querySelectorAll('[data-q-start]').forEach(el => {
                    el.addEventListener('click', (event) => {
                        // Stop event propagation to prevent parent container clicks
                        event.stopPropagation();

                        const qNum = parseInt(el.dataset.qStart, 10);
                        const qEnd = parseInt(el.dataset.qEnd, 10);

                        console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);

                        // Handle cases where qNum is NaN
                        if (isNaN(qNum)) {
                            console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                            return;
                        }

                        // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                        if (qNum === qEnd || el.classList.contains('tf-question')) {
                            if (currentQuestion !== qNum) {
                                console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                                goToQuestion(qNum);
                            } else {
                                console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                            }
                        } else {
                            console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                        }
                    });
                });

                // Add specific click listeners for individual question elements to prevent parent container interference
                document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                    el.addEventListener('click', (event) => {
                        event.stopPropagation();
                        const qNum = parseInt(el.dataset.qStart, 10);
                        console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);

                        // Handle cases where qNum is NaN (like .summary-text containers)
                        if (isNaN(qNum)) {
                            console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                            return;
                        }

                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                        }
                    });
                });

                // Add specific click listeners for individual input elements in questions 33-36
                document.querySelectorAll('.answer-input[id^="q3"]').forEach(input => {
                    input.addEventListener('click', (event) => {
                        event.stopPropagation();
                        const qNum = parseInt(input.id.replace('q', ''), 10);
                        console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);

                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                        }
                    });
                });

                // Add click listeners for the paragraph elements containing questions 33-36
                document.querySelectorAll('.summary-text p').forEach(p => {
                    p.addEventListener('click', (event) => {
                        event.stopPropagation();
                        // Extract question number from the paragraph text (e.g., "33" from "<strong>33</strong>")
                        const strongElement = p.querySelector('strong');
                        if (strongElement) {
                            const qNum = parseInt(strongElement.textContent, 10);
                            console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);

                            if (!isNaN(qNum) && currentQuestion !== qNum) {
                                console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                                goToQuestion(qNum);
                            } else if (!isNaN(qNum)) {
                                console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                            }
                        }
                    });
                });

                resizer.addEventListener('mousedown', initResize, false);
                initializeContextMenu();

                // Ensure indicators (answered states, counts) are correct on initial load
                updateAllIndicators();

                // Ensure the bottom menu reflects the currently focused input as active
                // 1) For text/select inputs with ids like q<number>
                document.querySelectorAll('.answer-input').forEach(inputEl => {
                    const attach = (evtName) => inputEl.addEventListener(evtName, (e) => {
                        const id = inputEl.id || '';
                        if (id.startsWith('q')) {
                            const qNum = parseInt(id.replace('q', ''), 10);
                            if (!isNaN(qNum)) {
                                goToQuestion(qNum);
                            }
                        } else {
                            // Fallback: find nearest container with data-q-start
                            const container = inputEl.closest('[data-q-start]');
                            if (container) {
                                const qNum = parseInt(container.dataset.qStart, 10);
                                if (!isNaN(qNum)) goToQuestion(qNum);
                            }
                        }
                    });
                    attach('focus');
                    attach('click');
                    attach('input');
                    attach('change');
                });

                // 2) For radio buttons (TF/NG and MCQ)
                document.querySelectorAll('input[type="radio"]').forEach(radioEl => {
                    const update = () => {
                        const name = radioEl.name || '';
                        if (name.startsWith('q')) {
                            const qNum = parseInt(name.replace('q', ''), 10);
                            if (!isNaN(qNum)) {
                                goToQuestion(qNum);
                            }
                        }
                    };
                    radioEl.addEventListener('focus', update);
                    radioEl.addEventListener('change', update);
                    radioEl.addEventListener('click', update);
                });
            }

            // --- CORE TEST LOGIC ---

            function checkAnswers() {
                // Disable all inputs to prevent changes
                const allInputs = document.querySelectorAll('input, select, textarea');
                allInputs.forEach(input => {
                    input.disabled = true;
                });

                // Disable all drag and drop functionality
                document.querySelectorAll('.drag-item').forEach(item => {
                    item.setAttribute('draggable', 'false');
                    item.style.cursor = 'not-allowed';
                    item.style.pointerEvents = 'none';
                });

                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.style.pointerEvents = 'none';
                    zone.classList.add('disabled');
                });

                // Disable submit button
                deliverButton.disabled = true;
                deliverButton.style.cursor = 'not-allowed';

                clearInterval(timerInterval);
                let score = 0;
                const totalQuestions = 40;
                const resultsDetailsContainer = document.getElementById('results-details');
                resultsDetailsContainer.innerHTML = '';

                document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                    el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
                });
                document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

                for (let i = 1; i <= totalQuestions; i++) {
                    const questionKey = String(i);
                    const correctAnswer = correctAnswers[questionKey];
                    let userAnswer = '';
                    let isCorrect = false;

                    let userAnswerDisplay = 'Not Answered';
                    const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                    const textInput = document.getElementById(`q${i}`);
                    const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);

                    // Handle Text and Select Inputs
                    if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                        const element = textInput.closest('.matching-form-row') || textInput;
                        userAnswer = textInput.value.trim();
                        userAnswerDisplay = userAnswer || 'Not Answered';

                        const normalize = (s) => (s || '')
                            .toString()
                            .toLowerCase()
                            .replace(/[^a-z0-9\s]/g, '')
                            .replace(/\s+/g, ' ')
                            .trim();

                        if (textInput.tagName === 'SELECT') {
                            isCorrect = userAnswer === correctAnswer;
                        } else {
                            const normUser = normalize(userAnswer);
                            if (Array.isArray(correctAnswer)) {
                                isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                            } else {
                                isCorrect = normalize(correctAnswer) === normUser;
                            }
                        }

                        if (isCorrect) {
                            score++;
                            element.classList.add('correct');
                        } else {
                            element.classList.add('incorrect');
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                            textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                        }
                    }
                    // Handle drag and drop questions (any with a drop-zone for this question)
                    else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`)) {
                        console.log(`🔍 Checking drag-and-drop question ${i}`);
                        const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`);
                        const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;

                        console.log(`📍 Drop zone for question ${i}:`, dropZone);
                        console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                        console.log(`📍 Correct answer for question ${i}:`, correctAnswer);

                        if (droppedItem) {
                            userAnswer = droppedItem.dataset.value;
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;

                            console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);

                            // Mark the drop zone as correct or incorrect
                            dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');

                            if (isCorrect) {
                                score++;
                                console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                            } else {
                                console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            }

                            // Show correct answer if wrong
                            if (!isCorrect && correctAnswer) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-answer-display';
                                correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                                dropZone.appendChild(correctAnswerSpan);
                            }
                        } else {
                            // No answer provided - mark as incorrect
                            console.log(`⚠️ No answer provided for question ${i}`);
                            if (dropZone) {
                                dropZone.classList.add('incorrect');
                            }
                            if (correctAnswer) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-answer-display';
                                correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                                dropZone.appendChild(correctAnswerSpan);
                            }
                        }
                    }
                    // Handle summary drag-and-drop questions (27-31) using summary-drop-zone
                    else if (document.querySelector(`.summary-drop-zone[data-question="${i}"]`)) {
                        console.log(`🔍 Checking summary drag-and-drop question ${i}`);
                        const dropZone = document.querySelector(`.summary-drop-zone[data-question="${i}"]`);
                        const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                        const correctAnswer = correctAnswers[questionKey];

                        if (droppedItem) {
                            userAnswer = droppedItem.dataset.value;
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;

                            dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                            if (isCorrect) {
                                score++;
                            } else if (correctAnswer) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-answer-display';
                                correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                                dropZone.appendChild(correctAnswerSpan);
                            }
                        } else {
                            userAnswerDisplay = 'Not Answered';
                            dropZone.classList.add('incorrect');
                            if (correctAnswer) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-answer-display';
                                correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                                dropZone.appendChild(correctAnswerSpan);
                            }
                        }
                    }
                    // Handle Radio Button Inputs (T/F, MCQs)
                    else if (radioGroup.length > 0) {
                        const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                        const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                        if (checkedRadio) {
                            userAnswer = checkedRadio.value;
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;

                            const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                            if (userLabel) {
                                userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }

                            // Handle table radio buttons
                            if (checkedRadio.classList.contains('table-radio')) {
                                const tableCell = checkedRadio.closest('td');
                                if (tableCell) {
                                    tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                                }
                            }
                        }

                        if (isCorrect) {
                            score++;
                        } else {
                            if (questionContainer) {
                                const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                                if (correctOptionEl) {
                                    const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                    if (correctLabel) {
                                        correctLabel.classList.add('correct-answer-highlight');
                                    }
                                }
                            }
                        }
                    }
                    // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                    else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                        console.log(`🔍 Checking clickable cell question ${i}`);
                        const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                        console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                        console.log(`📍 Correct answer for question ${i}:`, correctAnswer);

                        if (selectedCell) {
                            userAnswer = selectedCell.dataset.answer;
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;

                            console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);

                            selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');

                            if (isCorrect) {
                                score++;
                                console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                            } else {
                                console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            }
                        } else {
                            console.log(`⚠️ No answer provided for question ${i}`);
                            userAnswerDisplay = 'Not Answered';
                        }

                        // Handle highlighting correct answers for incorrect responses
                        if (!isCorrect) {
                            const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                            if (correctCell) {
                                correctCell.classList.add('correct-answer-highlight');
                                console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                            } else {
                                console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                            }
                        }
                    }
                    // Handle text input questions (33-39)
                    else if (i >= 33 && i <= 39) {
                        console.log(`🔍 Checking text input question ${i}`);
                        const textInput = document.getElementById(`q${i}`);

                        if (textInput) {
                            userAnswer = textInput.value.trim().toLowerCase();
                            userAnswerDisplay = userAnswer || 'Not Answered';

                            // Handle special case for question 33 which has two answers
                            if (i === 33) {
                                const answers = userAnswer.split('&').map(ans => ans.trim());
                                isCorrect = answers.includes('breathing') && answers.includes('eating');
                            } else {
                                isCorrect = userAnswer === correctAnswer.toLowerCase();
                            }

                            console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);

                            if (isCorrect) {
                                score++;
                                textInput.classList.add('correct');
                                console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                            } else {
                                textInput.classList.add('incorrect');
                                console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            }
                        } else {
                            console.log(`⚠️ No answer provided for question ${i}`);
                            userAnswerDisplay = 'Not Answered';
                        }
                    }
                    // Handle question 40 (multiple choice)
                    else if (i === 40) {
                        console.log(`🔍 Checking multiple choice question ${i}`);
                        const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                        if (checkedRadio) {
                            userAnswer = checkedRadio.value;
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;

                            console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);

                            const userLabel = checkedRadio.closest('.multi-choice-option');
                            if (userLabel) {
                                userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }

                            if (isCorrect) {
                                score++;
                                console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                            } else {
                                console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);

                                // Highlight correct answer
                                const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                                if (correctOptionEl) {
                                    const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                    if (correctLabel) {
                                        correctLabel.classList.add('correct-answer-highlight');
                                    }
                                }
                            }
                        } else {
                            console.log(`⚠️ No answer provided for question ${i}`);
                            userAnswerDisplay = 'Not Answered';
                        }
                    }
                    // Handle Checkbox Inputs (Multiple choice questions like 24-26)


                    // For showing results in the modal
                    const resultRow = `
                    <div class="result-row ${isCorrect ? 'correct' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                        <span class="status-badge ${isCorrect ? 'ok' : 'bad'}">${isCorrect ? 'Correct' : 'Incorrect'}</span>
                    </div>`;
                    resultsDetailsContainer.innerHTML += resultRow;

                    // Update nav button color
                    const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                    if (navButton) {
                        navButton.classList.remove('answered', 'active');
                        navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }

                document.getElementById('results-score').textContent = score;
                document.getElementById('results-band').textContent = calculateBandScore(score);
                document.body.classList.add('results-mode');
                document.getElementById('results-modal').classList.remove('hidden');

                // Change button to "My Result" with green styling
                deliverButton.innerHTML = `<span>My Result</span>`;
                deliverButton.style.backgroundColor = '#4CAF50';
                deliverButton.style.color = 'white';
                deliverButton.style.borderColor = '#4CAF50';
                deliverButton.disabled = false;
                deliverButton.style.cursor = 'pointer';
                deliverButton.removeEventListener('click', checkAnswers);
                deliverButton.addEventListener('click', showResultsModal);

                // Highlight correct answers in the passage
                highlightCorrectAnswersInPassage();
            }

            function calculateBandScore(score) {
                if (score >= 39) return '9.0';
                const mapping = {
                    40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                    33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                    26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                    19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                    12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                    5: 2.5, 4: 2.5
                };
                if (score <= 0) return 0.0;
                if (score === 1) return 1.0;
                if (score <= 3) return 2.0;
                if (score <= 5) return 2.5;
                return mapping[score] || 0.0;
            }

            function highlightCorrectAnswersInPassage() {
                // Define highlights for Part 1 (The Dinosaurs Footprints and Extinction)
                const part1Highlights = [
                    { question: 1, text: "That is the thesis proposed by Paul Olsen", answer: "YES" },
                    { question: 2, text: "the monsters depicted in the book and movie \"Jurassic Park\". (Actually, though, the dinosaurs that appeared on screen were from the still more recent Cretaceous period.)", answer: "NOT GIVEN" },
                    { question: 3, text: "Dinosaur skeletons are rare. Dinosaur footprints are, however, surprisingly abundant.", answer: "YES" },
                    { question: 4, text: "means that rocks from this place and period can be dated to within a few thousand years", answer: "NOT GIVEN" },
                    { question: 5, text: "ichnotaxa. These are recognizable types of the footprint that cannot be matched precisely with the species of animal that left them", answer: "NO" },
                    { question: 6, text: "Iridium is normally rare at the earth's surface, but it is more abundant in meteorites.", answer: "NO" },
                    { question: 7, text: "ecological release. This is seen today when reptiles", answer: "ecological release" },
                    { question: 8, text: "reach islands where they face no competitors.", answer: "competitors" },
                    { question: 9, text: "local lizards have grown so large that they are often referred to as dragons.", answer: "dragons" },
                    { question: 10, text: "It may, of course, have been overlooked.", answer: "overlooked" },
                    { question: 11, text: "Alternatively, it may have vanished.", answer: "vanished" },
                    { question: 12, text: "a crater that formed in the ocean would have been swallowed up by now.", answer: "swallowed up" },
                    { question: 13, text: "the crater is known, but has been misdated.", answer: "misdated" }
                ];

                // Define highlights for Part 2 (Art in Iron and Steel)
                const part2Highlights = [
                    { question: 14, text: "the relationship between art and engineering has seldom been easy or consistent.", answer: "C" },
                    { question: 16, text: "Lewis Hine", answer: "B" },
                    { question: 17, text: "his etchings of the partially completed Hell Gate and Delaware River bridges.", answer: "F" },
                    { question: 18, text: "landmark megastructures such as the Brooklyn and Golden Gate bridges are almost universally hailed as majestic human achievements", answer: "A" },
                    { question: 19, text: "\"Great engineering is great art,\" a sentiment that he expressed repeatedly.", answer: "E" },
                    { question: 20, text: "the painter/photographer Charles Sheeler was chosen to photograph it", answer: "B" },
                    { question: 21, text: "put his own life at risk to capture workers suspended on cables hundreds of feet in the air", answer: "F" },
                    { question: 22, text: "produced portraits involving subjects in engineers and inventions and historical human heroes.", answer: "D" },
                    { question: 23, text: "giving them titles such as American Landscape and Classic Landscape.", answer: "A" },
                    { question: 24, text: "Abraham Darby III cast", answer: "Abraham Darby III" },
                    { question: 25, text: "a dramatic departure from the classic stone and timber bridges", answer: "stone" },
                    { question: 26, text: "still spans the river", answer: "river" },
                    { text: "One artist's bucolic depiction shows pedestrians and horsemen on the bridge" },
                ];

                // Define highlights for Part 3 (Beyond the Blue Line)
                const part3Highlights = [
                    { question: 27, text: "an ancient seafaring people, the distant ancestors of today’s Polynesians", answer: "H" },
                    { question: 28, text: "scraped open a grave – the first of dozens in a burial ground some 3,000 years old.", answer: "L" },
                    { question: 29, text: "harbors the bones of an ancient people archaeologists call the Lapita", answer: "A" },
                    { question: 30, text: "their descendants, centuries later, who became the great Polynesian navigators", answer: "C" },
                    { question: 31, text: "there's no proof that they could do any such thing", answer: "F" },
                    { question: 32, text: "DNA teased from these ancient bones may also help answer one of the most puzzling questions in Pacific anthropology", answer: "D" },
                    { question: 33, text: "At some point in their lives, these people left the villages of their birth and made a voyage by seagoing canoe, never to return.", answer: "C" },
                    { question: 34, text: "for at least 150 of those miles, the Lapita sailors would have been out of sight of land, with empty horizons on every side.", answer: "A" },
                    { question: 35, text: "secure in the knowledge that if they didn't find anything, they could turn about and catch a swift ride home on the trade winds.", answer: "B" },
                    { question: 36, text: "mastered the advanced art of tacking into the wind.", answer: "TRUE" },
                    { question: 37, text: "they could turn about and catch a swift ride home on the trade winds.", answer: "FALSE" },
                    { question: 38, text: "called it quits for reasons known only to them.", answer: "TRUE" },
                    { question: 39, text: "more than 300 in Fiji alone.", answer: "FALSE" },
                    { question: 40, text: "a series of unusually frequent El Niño around the time of the Lapita expansion", answer: "NOT GIVEN" }
                ];

                // Function to apply highlights to a passage
                function applyHighlights(passageElement, highlights) {
                    if (!passageElement) return;

                    // Clear any existing highlights
                    passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                        const parent = el.parentNode;
                        parent.replaceChild(document.createTextNode(el.textContent), el);
                        parent.normalize();
                    });

                    // Add highlights for each answer
                    highlights.forEach(item => {
                        const paragraphs = passageElement.querySelectorAll('p');
                        paragraphs.forEach(paragraph => {
                            const html = paragraph.innerHTML;
                            if (!html || typeof html !== 'string') return;
                            if (html.includes(item.text)) {
                                const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                                const re = new RegExp(escapeRegExp(item.text));
                                const badge = (item.question !== undefined && item.question !== null && item.question !== '')
                                    ? `<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span>`
                                    : '';
                                const replaced = html.replace(
                                    re,
                                    `<span class="answer-highlight" data-question="${item.question || ''}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}${badge}</span>`
                                );
                                paragraph.innerHTML = replaced;
                            }
                        });
                    });
                }

                // Apply highlights to Part 1 (The Green Revolution in China)
                const passageText1 = document.getElementById('passage-text-1');
                applyHighlights(passageText1, part1Highlights);

                // Apply highlights to Part 2 (Reclaiming the Night)
                const passageText2 = document.getElementById('passage-text-2');
                applyHighlights(passageText2, part2Highlights);

                // Apply highlights to Part 3 (Paper or Computer?)
                const passageText3 = document.getElementById('passage-text-3');
                applyHighlights(passageText3, part3Highlights);
            }

            function getUserAnswer(qNum) {
                const textInput = document.getElementById(`q${qNum}`);
                const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
                const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

                if (textInput) { // Handles <input type="text"> and <select>
                    return { value: textInput.value, text: textInput.value || 'N/A' };
                }
                if (radioInput) {
                    return { value: radioInput.value, text: radioInput.value };
                }
                if (dropZone) {
                    const droppedItem = dropZone.querySelector('.drag-item');
                    return {
                        value: droppedItem ? droppedItem.dataset.value : null,
                        text: droppedItem ? droppedItem.textContent.trim() : 'N/A'
                    };
                }
                // Handle clickable cells for questions 23-26
                if (qNum >= 23 && qNum <= 26) {
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                    if (selectedCell) {
                        return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                    }
                }
                return { value: null, text: 'N/A' };
            }

            function displayCorrectAnswer(qNum, correctAnswer) {
                // Handle multi-choice group questions (e.g., 24-26, 38-40)
                // No special checkbox groups used; fall through

                // Handle radio button questions by highlighting the correct label
                const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
                if (correctRadioInput) {
                    const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                    if (parentOption) {
                        parentOption.classList.add('correct-answer-highlight');
                        return;
                    }
                }

                // Handle text inputs, select dropdowns, and others by showing the answer next to them
                const inputEl = document.getElementById(`q${qNum}`);
                if (inputEl) {
                    const displaySpan = document.createElement('span');
                    displaySpan.className = 'correct-answer-display';
                    displaySpan.textContent = ` ✓ ${correctAnswer}`;
                    inputEl.insertAdjacentElement('afterend', displaySpan);
                    return; // Done
                }

                // Fallback for questions identified by a container (e.g., some T/F/NG questions)
                const element = findQuestionElement(qNum);
                if (element) {
                    const displaySpan = document.createElement('span');
                    displaySpan.className = 'correct-answer-display';
                    displaySpan.textContent = ` ✓ ${correctAnswer}`;
                    const itemContainer = element.querySelector('.tf-question-text');
                    if (itemContainer) {
                        itemContainer.appendChild(displaySpan);
                    } else {
                        element.appendChild(displaySpan);
                    }
                }
            }

            function findQuestionElement(qNum) {
                return document.querySelector(`[data-q-start="${qNum}"]`);
            }

            function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
                const resultsDetails = document.getElementById('results-details');
                const row = document.createElement('div');
                row.className = 'result-row';
                if (!isCorrect) {
                    row.classList.add('incorrect');
                }
                row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
                resultsDetails.appendChild(row);
            }

            function showResultsModal() {
                document.getElementById('results-modal').classList.remove('hidden');
            }

            window.closeResultsModal = function () {
                document.getElementById('results-modal').classList.add('hidden');
                document.body.classList.remove('results-mode');
            }

            function disableInputs() {
                deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
                deliverButton.removeEventListener('click', checkAnswers);
                deliverButton.onclick = showResultsModal;

                document.querySelectorAll('input, select').forEach(el => {
                    el.disabled = true;
                    if (el.matches('input[type=radio], input[type=checkbox]')) {
                        el.style.cursor = 'not-allowed';
                        el.parentElement.style.cursor = 'not-allowed';
                    }
                });
                document.querySelectorAll('.drag-item').forEach(el => {
                    el.setAttribute('draggable', 'false');
                    el.style.cursor = 'default';
                });
                document.querySelectorAll('.drop-zone').forEach(el => {
                    el.classList.add('disabled');
                });
            }

            function checkValue(userValue, correctValue) {
                if (userValue === null || userValue === undefined) return false;
                const formattedUserValue = userValue.trim().toLowerCase();
                if (Array.isArray(correctValue)) {
                    return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
                } else {
                    return formattedUserValue === String(correctValue).toLowerCase();
                }
            }

            function markQuestion(qNum, isCorrect) {
                const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

                const elementsToMark = [
                    document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                    document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                    document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                    document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                    document.getElementById(`q${qNum}`),
                    document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                    document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
                ];

                elementsToMark.forEach(el => {
                    if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
                });

                if (qNum === 14 || qNum === 15) {
                    const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                    if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
                } else if (qNum >= 1 && qNum <= 5) {
                    const pMatchInput = document.getElementById(`q${qNum}`);
                    if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            }

            function switchToPart(partNumber) {
                console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);

                currentPassage = partNumber;

                // Hide all passages and questions
                document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                    el.classList.add('hidden');
                });

                // Show the correct passage, questions, and header
                document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
                document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
                document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

                // Update bottom navigation 'selected' state
                document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                    wrapper.classList.toggle('selected', (index + 1) === partNumber);
                });

                // Show/hide explanation buttons based on part
                const explanationButton = document.getElementById('show-explanation-btn');
                const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');

                if (explanationButton) {
                    if (partNumber === 2) {
                        explanationButton.style.display = 'block';
                    } else {
                        explanationButton.style.display = 'none';
                        // Hide explanation section when switching away from part 2
                        const explanationSection = document.getElementById('part-2-explanation');
                        if (explanationSection) {
                            explanationSection.classList.add('hidden');
                            explanationButton.textContent = 'Show Explanation';
                            explanationButton.style.backgroundColor = '#4a90e2';
                        }
                    }
                }

                if (explanationButtonPart3) {
                    if (partNumber === 3) {
                        explanationButtonPart3.style.display = 'block';
                    } else {
                        explanationButtonPart3.style.display = 'none';
                        // Hide explanation section when switching away from part 3
                        const explanationSection = document.getElementById('part-3-explanation');
                        if (explanationSection) {
                            explanationSection.classList.add('hidden');
                            explanationButtonPart3.textContent = 'Show Explanation';
                            explanationButtonPart3.style.backgroundColor = '#4a90e2';
                        }
                    }
                }

                console.log(`✅ switchToPart completed - switched to part ${partNumber}`);

                // Only go to first question when switching parts, not when staying in same part
                // This allows goToQuestion to work properly for specific question navigation
                // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
                // goToQuestion(firstQuestionOfPart);
            }

            function goToQuestion(questionNumber) {
                console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);

                currentQuestion = questionNumber;

                let passageNumber = 1;
                if (questionNumber >= 15 && questionNumber <= 27) passageNumber = 2;
                else if (questionNumber >= 27) passageNumber = 3;

                console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);

                if (currentPassage !== passageNumber) {
                    console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                    switchToPart(passageNumber);
                    return;
                }

                console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

                if (activeQuestionElement) {
                    // Remove active style from previous block
                    activeQuestionElement.classList.remove('active-question', 'active-input');
                    // Also remove from the container block if we previously set it
                    const prevBlock = activeQuestionElement.closest('[data-q-start]');
                    if (prevBlock) prevBlock.classList.remove('active-question');
                }

                // First, try to find the specific input element for questions 33-36
                let targetEl = document.getElementById(`q${questionNumber}`);
                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found specific input element:`, targetEl);
                    targetEl.classList.add('active-input');
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    // Fall back to looking for question containers
                    targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
                    console.log(`🔍 Looking for target element with data-q-start="${questionNumber}":`, targetEl);

                    if (targetEl) {
                        activeQuestionElement = targetEl;
                        console.log(`✅ Found target element:`, targetEl);

                        if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                            targetEl.classList.add('active-input');
                            console.log(`📝 Added active-input class to input/select element`);
                        } else {
                            targetEl.classList.add('active-question');
                            console.log(`📋 Added active-question class to question element`);
                        }
                        scrollIntoViewIfNeeded(targetEl);
                    } else {
                        console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                        const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                        if (pMatch) {
                            activeQuestionElement = pMatch;
                            pMatch.classList.add('active-input');
                            scrollIntoViewIfNeeded(pMatch);
                            console.log(`✅ Found paragraph matching question:`, pMatch);
                        } else {
                            console.log(`❌ No target element found for question ${questionNumber}`);
                        }
                    }
                }

                updateNavigation();
                console.log(`✅ goToQuestion completed for question ${questionNumber}`);
            }

            // --- UI & NAVIGATION ---

            function updateNavigation() {
                console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);

                const navButtons = document.querySelectorAll('.subQuestion');
                navButtons.forEach(btn => btn.classList.remove('active'));
                const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
                if (activeNav) {
                    activeNav.classList.add('active');
                    console.log(`✅ Updated navigation - active nav button:`, activeNav);
                } else {
                    console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
                }

                const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
                inputs.forEach(input => input.classList.remove('active-input'));

                const activeInput = document.getElementById(`q${currentQuestion}`);
                if (activeInput) {
                    activeInput.classList.add('active-input');
                    if (typeof activeInput.focus === 'function') {
                        activeInput.focus();
                    }
                    console.log(`✅ Focused on input element:`, activeInput);
                } else {
                    console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                    // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start container
                    let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`)
                        || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`)
                        || document.querySelector(`[data-q-start="${currentQuestion}"]`);
                    if (activeQuestionBlock) {
                        // Add active-question class to style number badge
                        activeQuestionBlock.classList.add('active-question');
                        const firstInput = activeQuestionBlock.querySelector('input, select');
                        if (firstInput) {
                            firstInput.classList.add('active-input');
                            if (typeof firstInput.focus === 'function') {
                                firstInput.focus();
                            }
                            console.log(`✅ Focused on input in question block:`, firstInput);
                        } else {
                            console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                        }
                    } else {
                        console.log(`❌ No question block found for question ${currentQuestion}`);
                    }
                }

                console.log(`✅ updateNavigation completed`);
            }

            function selectDragItem(item) {
                if (selectedDragItem) {
                    selectedDragItem.classList.remove('selected');
                }
                selectedDragItem = item;
                if (selectedDragItem) {
                    selectedDragItem.classList.add('selected');
                }
            }

            window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
            window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

            function updateAllIndicators() {
                updateAttemptedCount(1, 1, 13);
                updateAttemptedCount(2, 14, 26);
                updateAttemptedCount(3, 27, 40);
                updateAnsweredNav();
            }

            function updateAnsweredNav() {
                const navButtons = document.querySelectorAll('.subQuestion');
                navButtons.forEach(btn => {
                    let qNum = NaN;
                    // Prefer parsing from onclick attribute to avoid SR-only text interference
                    const onclickAttr = btn.getAttribute('onclick');
                    if (onclickAttr) {
                        const match = onclickAttr.match(/goToQuestion\((\d+)\)/);
                        if (match) {
                            qNum = parseInt(match[1], 10);
                        }
                    }

                    // Fallback: try the visible number span
                    if (isNaN(qNum)) {
                        const visibleSpan = btn.querySelector('span[aria-hidden="true"]');
                        if (visibleSpan) {
                            qNum = parseInt(visibleSpan.textContent.trim(), 10);
                        }
                    }

                    if (!isNaN(qNum) && isQuestionAnswered(qNum)) {
                        btn.classList.add('answered');
                    } else {
                        btn.classList.remove('answered');
                    }
                });
            }

            function isQuestionAnswered(qNum) {
                const textInput = document.getElementById(`q${qNum}`);
                if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                    return true;
                }
                const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
                if (radio) {
                    return true;
                }
                const checkbox = document.querySelector(`input[name="q${qNum}"]:checked`);
                if (checkbox) {
                    return true;
                }
                // Handle drag & drop questions (e.g., 20-23)
                const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
                if (dz && dz.querySelector('.drag-item')) {
                    return true;
                }
                // Handle summary drag & drop questions (27-31)
                const sdz = document.querySelector(`.summary-drop-zone[data-question="${qNum}"]`);
                if (sdz && sdz.querySelector('.drag-item')) {
                    return true;
                }
                // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
                }
                return false;
            }

            function scrollIntoViewIfNeeded(element) {
                const panel = element.closest('.questions-panel, .passage-panel');
                const panelRect = panel.getBoundingClientRect();
                const elementRect = element.getBoundingClientRect();
                if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // --- DRAG AND DROP ---

            function initializeDragAndDrop() {
                document.querySelectorAll('.drag-item').forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                    item.addEventListener('click', () => selectDragItem(item));
                });
                document.querySelectorAll('.drop-zone, .summary-drop-zone, .drag-options-container').forEach(zone => {
                    zone.addEventListener('dragover', handleDragOver);
                    zone.addEventListener('dragleave', handleDragLeave);
                    zone.addEventListener('drop', handleDrop);
                });
            }

            function handleDragStart(e) {
                draggedItem = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0);
            }

            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
                draggedItem = null;
            }

            function handleDragOver(e) {
                e.preventDefault();
                const targetZone = e.currentTarget;
                if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                    targetZone.classList.add('drag-over');
                }
            }

            function handleDragLeave(e) {
                e.currentTarget.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                const targetZone = e.currentTarget;
                targetZone.classList.remove('drag-over');

                if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                    return;
                }

                const sourceZone = draggedItem.parentElement;
                if (sourceZone === targetZone) return; // Prevent dropping on itself

                const isTargetAcceptingZone = targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone');
                const existingItemInTarget = isTargetAcceptingZone ? targetZone.querySelector('.drag-item') : null;

                // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
                if (targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')) {
                    Array.from(targetZone.childNodes).forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            node.remove();
                        }
                    });
                }

                // Move the item that was in the target (if any) to the source zone.
                if (existingItemInTarget) {
                    sourceZone.appendChild(existingItemInTarget);
                }

                // Finally, move the dragged item to the target zone.
                targetZone.appendChild(draggedItem);
                targetZone.classList.add('filled');
                // Lock the pill-like appearance for items dropped into zones
                if (draggedItem) {
                    draggedItem.style.cursor = 'default';
                }
                // Hide placeholder text (question number) once filled
                if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                    targetZone.textContent = '';
                }

                // After the move, clean up the source zone if it's a drop-zone and is now empty.
                if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                    sourceZone.classList.remove('filled');
                    const qNum = sourceZone.dataset.qStart;
                    sourceZone.innerText = qNum; // Restore the question number
                }
                // Also handle summary drop-zones when emptied
                if (sourceZone.classList.contains('summary-drop-zone') && !sourceZone.querySelector('.drag-item')) {
                    sourceZone.classList.remove('filled');
                }

                updateAllIndicators();
            }

            // --- MISC HELPERS ---

            function startTimer() {
                if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
                timerInterval = setInterval(() => {
                    timeInSeconds--;
                    const minutes = Math.floor(timeInSeconds / 60);
                    const seconds = timeInSeconds % 60;
                    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    if (timeInSeconds <= 0) {
                        clearInterval(timerInterval);
                        timerDisplay.textContent = "Time's up!";
                        // checkAnswers(); // Disabled to prevent modal from opening automatically.
                    }
                }, 1000);
                timerToggleButton.innerHTML = pauseIcon;
            }

            function pauseTimer() {
                clearInterval(timerInterval);
                timerToggleButton.innerHTML = playIcon;
            }

            function toggleTimer() {
                // Check based on the icon currently displayed
                if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                    pauseTimer();
                } else {
                    startTimer();
                }
            }

            function resetTimer() {
                timeInSeconds = 3600;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                startTimer();
                timerToggleButton.innerHTML = pauseIcon;
            }

            function setupCheckboxLimits() {
                const checkboxGroups = [
                    { name: 'q38-40', limit: 3 }
                ];
                checkboxGroups.forEach(group => {
                    const checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', () => {
                            const checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                            if (checkedCount > group.limit) checkbox.checked = false;
                            updateAllIndicators();
                        });
                    });
                });
            }

            function setupExampleHeading() {
                const exampleBox = document.querySelector('.example-box');
                if (exampleBox) {
                    const title = document.createElement('p');
                    title.style.fontWeight = 'bold';
                    title.textContent = 'List of Statements';
                    // exampleBox.insertBefore(title, exampleBox.firstChild);
                }
            }

            function initResize(e) {
                e.preventDefault();
                const startX = e.clientX;
                const startWidth = passagePanel.offsetWidth;

                const doDrag = (e) => {
                    const newWidth = startWidth + e.clientX - startX;
                    if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                        passagePanel.style.flex = `0 0 ${newWidth}px`;
                    }
                };
                const stopDrag = () => {
                    window.removeEventListener('mousemove', doDrag, false);
                    window.removeEventListener('mouseup', stopDrag, false);
                };

                window.addEventListener('mousemove', doDrag, false);
                window.addEventListener('mouseup', stopDrag, false);
            }

            // --- CONTEXT MENU (Highlighting) ---

            function initializeContextMenu() {
                const panels = [passagePanel, questionsPanel];
                let targetElementForClear = null;

                // This listener simply tracks the last valid text selection in either panel.
                document.addEventListener('selectionchange', () => {
                    const selection = window.getSelection();
                    if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                        const range = selection.getRangeAt(0);
                        if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                            selectedRange = range;
                            targetElementForClear = null; // New selection overrides clearing a specific element
                        }
                    }
                });

                const showContextMenu = (e) => {
                    const target = e.target;
                    const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                    const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;

                    let showMenu = false;

                    if (isClickOnHighlight) {
                        document.getElementById('menu-highlight').style.display = 'none';
                        document.getElementById('menu-note').style.display = 'none';
                        document.getElementById('menu-clear').style.display = 'block';
                        document.getElementById('menu-clear-all').style.display = 'block';
                        contextMenu.targetElementForClear = isClickOnHighlight;
                        showMenu = true;
                    } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                        document.getElementById('menu-highlight').style.display = 'flex';
                        document.getElementById('menu-note').style.display = 'flex';
                        document.getElementById('menu-clear').style.display = 'none';
                        document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                        showMenu = true;
                    }

                    if (showMenu) {
                        e.preventDefault();
                        contextMenu.style.display = 'block';
                        const menuHeight = contextMenu.offsetHeight;
                        const menuWidth = contextMenu.offsetWidth;
                        let left = e.pageX;
                        let top = e.pageY;
                        if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                        if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                        else top = e.pageY - menuHeight - 5;

                        contextMenu.style.left = `${left}px`;
                        contextMenu.style.top = `${top}px`;
                    }
                };

                panels.forEach(panel => {
                    panel.addEventListener('contextmenu', showContextMenu);
                });

                document.addEventListener('click', (e) => {
                    if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                        closeContextMenu();
                    }
                });
            }

            function closeContextMenu() {
                contextMenu.style.display = 'none';
                selectedRange = null; // Clear range after menu closes
            }

            function unwrapElement(element) {
                const parent = element.parentNode;
                if (!parent) return;
                while (element.firstChild) {
                    parent.insertBefore(element.firstChild, element);
                }
                parent.removeChild(element);
                parent.normalize();
            }

            window.highlightText = () => {
                if (selectedRange && !selectedRange.collapsed) {
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    span.appendChild(selectedRange.extractContents());
                    selectedRange.insertNode(span);
                }
                closeContextMenu();
                window.getSelection().removeAllRanges();
            };

            window.addNote = () => {
                const note = prompt('Enter your note:');
                if (note && selectedRange && !selectedRange.collapsed) {
                    const span = document.createElement('span');
                    span.className = 'comment-highlight';
                    const tooltip = document.createElement('span');
                    tooltip.className = 'comment-tooltip';
                    tooltip.textContent = note;
                    span.appendChild(selectedRange.extractContents());
                    span.appendChild(tooltip);
                    selectedRange.insertNode(span);
                }
                closeContextMenu();
                window.getSelection().removeAllRanges();
            };

            window.clearHighlight = () => {
                const elementToClear = contextMenu.targetElementForClear;
                if (elementToClear) {
                    unwrapElement(elementToClear);
                }
                closeContextMenu();
                window.getSelection().removeAllRanges();
            };

            window.clearAllHighlights = () => {
                document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
                closeContextMenu();
                window.getSelection().removeAllRanges();
            };

            function updateAttemptedCount(part, startQ, endQ) {
                let answeredCount = 0;
                for (let i = startQ; i <= endQ; i++) {
                    if (isQuestionAnswered(i)) {
                        answeredCount++;
                    }
                }
                const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
                if (partHeader) {
                    const countSpan = partHeader.querySelector('.attemptedCount');
                    if (countSpan) {
                        countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                    }
                }
            }

            // --- GLOBAL FUNCTION EXPOSURE ---
            window.nextQuestion = nextQuestion;
            window.previousQuestion = previousQuestion;
            window.goToQuestion = goToQuestion;
            window.switchToPart = switchToPart;
            window.closeResultsModal = closeResultsModal;
            window.highlightText = highlightText;
            window.addNote = addNote;
            window.clearHighlight = clearHighlight;
            window.clearAllHighlights = clearAllHighlights;

            // Explanation toggle function for Part 2
            window.toggleExplanation = function () {
                const explanationSection = document.getElementById('part-2-explanation');
                const button = document.getElementById('show-explanation-btn');

                if (explanationSection.classList.contains('hidden')) {
                    explanationSection.classList.remove('hidden');
                    button.textContent = 'Hide Explanation';
                    button.style.backgroundColor = '#dc3545';
                } else {
                    explanationSection.classList.add('hidden');
                    button.textContent = 'Show Explanation';
                    button.style.backgroundColor = '#4a90e2';
                }
            };

            // Explanation toggle function for Part 3
            window.toggleExplanationPart3 = function () {
                const explanationSection = document.getElementById('part-3-explanation');
                const button = document.getElementById('show-explanation-btn-part3');

                if (explanationSection.classList.contains('hidden')) {
                    explanationSection.classList.remove('hidden');
                    button.textContent = 'Hide Explanation';
                    button.style.backgroundColor = '#dc3545';
                } else {
                    explanationSection.classList.add('hidden');
                    button.textContent = 'Show Explanation';
                    button.style.backgroundColor = '#4a90e2';
                }
            };

            // --- START THE APP ---
            initialize();

            // Add event listeners for table radio buttons
            document.addEventListener('DOMContentLoaded', function () {
                const tableRadios = document.querySelectorAll('.table-radio');
                tableRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        // Remove background color from all cells in the same row
                        const row = this.closest('tr');
                        const cells = row.querySelectorAll('td:not(.statement)');
                        cells.forEach(cell => {
                            cell.style.backgroundColor = '';
                        });

                        // Add background color to the selected cell
                        if (this.checked) {
                            this.closest('td').style.backgroundColor = '#e3f2fd';
                        }

                        updateAllIndicators();
                    });
                });


            });

            // Global function for selecting cells
            window.selectCell = function (cell, questionNum, value) {
                console.log('selectCell called:', questionNum, value);

                // Remove selected class from all cells in the same row
                const row = cell.closest('tr');
                const cellsInRow = row.querySelectorAll('.clickable-cell');
                cellsInRow.forEach(c => {
                    c.classList.remove('selected');
                    c.removeAttribute('data-selected');
                    c.removeAttribute('data-answer');
                });

                // Add selected class to clicked cell
                cell.classList.add('selected');
                cell.setAttribute('data-selected', 'true');
                cell.setAttribute('data-answer', value);

                console.log('Cell selected:', questionNum, value);
                updateAllIndicators();
            };



            // Note: switchToPart function is defined earlier in the code
            // This duplicate function has been removed to prevent conflicts
        });
    </script>
</body>

</html>